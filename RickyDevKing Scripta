local Players = game.Players
local LocalPlayer = Players.LocalPlayer
local ItemFolder = game.Workspace:WaitForChild("Item")
local LivingFolder = game.Workspace:WaitForChild("Living")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")

local Teleported, Active, LastTeleported = false, false, 0
local Items = {"Arrow", "Bari Bari Devil Fruit", "Barrel", "Bomu Bomu Devil Fruit", 
               "Mysterious Camera", "Hamon Manual", "Haunted Sword", "Mochi Mochi Devil Fruit", 
               "Rokakaka", "Spin Manual", "Stop Sign", "Stone Mask", "New Item"}

local Npcs = {"Thug", "Bandit", "Glutton Curse", "Mosquito Curse", "Contorted Curse", 
              "Spider Curse", "Paper Curse", "Frog Hollow", "Fishbone"}

local ChestKey = "Chest Key"
local Key1, Key2 = Enum.KeyCode.E, Enum.KeyCode.Z

local function ShowNotification(title, message, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {Title = title, Text = message, Duration = duration})
end

local function EquipChestKey()
    local chestKey = LocalPlayer.Backpack:FindFirstChild(ChestKey)
    if chestKey and not LocalPlayer.Character:FindFirstChild(ChestKey) then
        chestKey.Parent = LocalPlayer.Backpack
    end
end

local function TeleportToPosition(Position)
    local Character = LocalPlayer.Character
    if Position and Character then
        Character:SetPrimaryPartCFrame(Position.CFrame)
        Teleported = true
    end
end

local function PressKey(key)
    VirtualInputManager:SendKeyEvent(true, key, false, game)
end

local function ReleaseKey(key)
    VirtualInputManager:SendKeyEvent(false, key, false, game)
end

local function FindNpc()
    for _, npc in ipairs(LivingFolder:GetChildren()) do
        if npc:IsA("Model") and table.find(Npcs, npc.Name) then
            return npc
        end
    end
end

local function FindValidItems()
    local validItems = {}
    for _, item in ipairs(ItemFolder:GetChildren()) do
        if item:IsA("BasePart") and (item.Name == "Chest" or item.Name:match("Box") or 
           item.Name == "SukunaFinger" or item.Name == "New Item") then
            table.insert(validItems, item)
        end
    end
    return validItems
end

local function SellValidItems()
    for _, item in ipairs(LocalPlayer.Backpack:GetChildren()) do
        if item:IsA("Tool") and table.find(Items, item.Name) then
            ReplicatedStorage.GlobalUsedRemotes.SellItem:FireServer(item.Name)
        end
    end
end

local function UseSkills()
    local keys = {Enum.KeyCode.Q, Enum.KeyCode.E, Enum.KeyCode.R, Enum.KeyCode.T, Enum.KeyCode.Y,
                  Enum.KeyCode.U, Enum.KeyCode.G, Enum.KeyCode.H, Enum.KeyCode.J, Enum.KeyCode.B, Enum.KeyCode.N}
    for _, key in ipairs(keys) do
        PressKey(key)
        task.wait(0.1)
        ReleaseKey(key)
    end
end

local function TeleportAndAttackNpc(npc)
    if npc and npc.PrimaryPart then
        local humanoid = npc:FindFirstChild("Humanoid")
        if humanoid and humanoid.Health > 0 then
            TeleportToPosition(npc.PrimaryPart)
            task.wait()
            UseSkills()
        end
    end
end

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Key2 then
        Active = not Active
        ShowNotification("Script " .. (Active and "Activated" or "Deactivated"), 
                         "Press 'Z' again to " .. (Active and "stop" or "start") .. ".", 5)
    end
end)

ShowNotification("Sakura Stand Farming Script 2025", "Made by RickyDevKing", 5)

while true do
    if Active then
        local npc = FindNpc()
        if npc then
            while npc.Parent and npc.Parent == LivingFolder do
                TeleportAndAttackNpc(npc)
                task.wait(1)
            end
        else
            local validItems = FindValidItems()
            if #validItems > 0 then
                local randomItem = validItems[math.random(1, #validItems)]
                TeleportToPosition(randomItem)
                task.wait(1.5)
                PressKey(Key1)
                task.wait(1)

                ReplicatedStorage.GlobalUsedRemotes.Breakthrough:FireServer()
                ReplicatedStorage.GlobalUsedRemotes.UpgradeMas:FireServer()
            elseif Teleported then
                ReleaseKey(Key1)
                Teleported = false
            end
            SellValidItems()
            EquipChestKey()
        end
    end
    task.wait(1)
end
